version: "3.7"
services:
  canids-v2-ingestion:
    build:
      context: .
      dockerfile: ./ingestion/Dockerfile
    image: mcmaster-circ/canids-v2-ingestion
    container_name: canids-v2-ingestion
    logging:
      driver: "json-file"
      options:
        max-size: "1m"
        max-file: "5"
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
    restart: unless-stopped
    security_opt:
      - apparmor:unconfined
    environment:
      - flags=--key  # Change this to specify additional flags (eg. --insecure). Put key received from api after --key
      - asset=testdata2 # Change this to specify your asset name
      - hostname=http://host.docker.internal:6060/websocket/ # Change this to specify the address of the backend
    volumes:
      - ./ingestion/logs:/logs # Change this to specify the location of your logs
      - ingestiondb:/db

secrets:
  canids_ca_cert:
    file: ./ingestion/cert
volumes:
  ingestiondb:
